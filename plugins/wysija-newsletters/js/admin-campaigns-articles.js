var allposts=new Array();var query_offset=0;var wysappend=0;var totalReached=false;jQuery(function(d){d("#gallery-form").submit(function(){query_offset=0;allposts=new Array();e();return false});d("#fullarticlesget").change(function(){query_offset=0;allposts=new Array();e();return false});d("select#cpt").change(function(){query_offset=0;allposts=new Array();e();return false});function e(){var f="<ul class='loading-ul'>";f+="<li><img title='Loading' alt='loading' src='../wp-content/plugins/wysija-newsletters/img/wpspin_light.gif' /></li>";f+="</ul>";if(wysappend){d("#search-results").append(f)}else{d("#search-results").html(f)}wysijaAJAX.task="getarticles";wysijaAJAX.search=d("#search-box").val();wysijaAJAX.cpt=d("select#cpt").val();wysijaAJAX.query_offset=query_offset;if(d("#fullarticlesget").is(":checked")){wysijaAJAX.fullarticle=1}else{delete wysijaAJAX.fullarticle}wysijaAJAX._wpnonce=d("#wysijax").val();jQuery.ajax({type:"POST",url:wysijaAJAX.ajaxurl,data:wysijaAJAX,success:c,error:b,dataType:"json"})}function c(h){if(h.result["result"]){for(var g in h.result["posts"]){allposts.push(h.result["posts"][g])}var f='<ul class="posts">',i;d.each(h.result["posts"],function(l,k){i={src:null,alt:"",title:""};if(k.post_image!==null){i.src=k.post_image["src"];i.alt=k.post_image["alt"];i.title=k.post_title}var j=query_offset+l;f+='<li class="clearfix" onClick="return selectArticle('+j+')">';f+='<div class="article-cpt">';if(i.src!==null){f+='<div class="thumbnail"><img width="60" title="'+i.title+'" src="'+i.src+'" alt="'+i.alt+'" /></div>'}f+="<h3>"+k.post_title+'</h3></div><div class="cpt-type">'+k.post_type+"</div></li>"});f+="</ul>"}else{if(h.result["append"]){var f=""}else{var f="<ul>";f+="<li><strong>"+h.result["msg"]+"</strong></li>";f+="</ul>"}}d("#search-results").find(".loading-ul").remove();if(h.result["append"]){if(f!==""){d("#search-results").append("<hr/>"+f)}}else{d("#search-results").html(f)}wysappend=0;if(parseInt(h.result["total"])===d("ul.posts li").length){totalReached=true}else{totalReached=false}}function b(g,f){wysappend=0;alert("Request error not JSON:"+g.responseText)}d(function(){e()});d(window).scroll(function(){if(totalReached===false&&allposts.length>=10&&!wysappend&&d(window).scrollTop()===(d(document).height()-d(window).height())){a()}});function a(){query_offset=query_offset+10;wysappend=1;e()}});function selectArticle(a){window.parent.WysijaPopup.success(allposts[a]["html"])};